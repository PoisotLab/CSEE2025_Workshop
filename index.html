<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Interpretable machine learning for species distribution modeling – Interpretable ML for SDMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Interpretable ML for SDMs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Tutorial</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#todo-list" id="toc-todo-list" class="nav-link active" data-scroll-target="#todo-list"><strong>TODO LIST</strong></a></li>
  <li><a href="#setup-packages" id="toc-setup-packages" class="nav-link" data-scroll-target="#setup-packages">Setup Packages</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a>
  <ul class="collapse">
  <li><a href="#downloading-polygon-data" id="toc-downloading-polygon-data" class="nav-link" data-scroll-target="#downloading-polygon-data">Downloading Polygon Data</a></li>
  <li><a href="#downloading-environmental-data" id="toc-downloading-environmental-data" class="nav-link" data-scroll-target="#downloading-environmental-data">Downloading Environmental Data</a>
  <ul class="collapse">
  <li><a href="#masking-the-environmental-layers" id="toc-masking-the-environmental-layers" class="nav-link" data-scroll-target="#masking-the-environmental-layers">Masking the environmental layers</a></li>
  </ul></li>
  <li><a href="#downloading-occurrence-data" id="toc-downloading-occurrence-data" class="nav-link" data-scroll-target="#downloading-occurrence-data">Downloading occurrence data</a></li>
  <li><a href="#computing-statistics-with-occurrences" id="toc-computing-statistics-with-occurrences" class="nav-link" data-scroll-target="#computing-statistics-with-occurrences">Computing statistics with occurrences</a></li>
  <li><a href="#associating-environmental-covariates-with-occurrences" id="toc-associating-environmental-covariates-with-occurrences" class="nav-link" data-scroll-target="#associating-environmental-covariates-with-occurrences">Associating Environmental Covariates with Occurrences</a></li>
  </ul></li>
  <li><a href="#building-a-simple-species-distribution-model" id="toc-building-a-simple-species-distribution-model" class="nav-link" data-scroll-target="#building-a-simple-species-distribution-model">Building a Simple Species Distribution Model</a>
  <ul class="collapse">
  <li><a href="#sampling-pseudo-absences" id="toc-sampling-pseudo-absences" class="nav-link" data-scroll-target="#sampling-pseudo-absences">Sampling Pseudo-Absences</a></li>
  <li><a href="#training-a-simple-sdm" id="toc-training-a-simple-sdm" class="nav-link" data-scroll-target="#training-a-simple-sdm">Training a Simple SDM</a></li>
  <li><a href="#computing-roc-auc-and-pr-auc" id="toc-computing-roc-auc-and-pr-auc" class="nav-link" data-scroll-target="#computing-roc-auc-and-pr-auc">Computing ROC-AUC and PR-AUC</a></li>
  <li><a href="#simple-explanations-partial-response" id="toc-simple-explanations-partial-response" class="nav-link" data-scroll-target="#simple-explanations-partial-response">Simple Explanations: Partial Response</a></li>
  </ul></li>
  <li><a href="#a-more-complex-sdm-boosted-regression-trees-from-scratch-ish" id="toc-a-more-complex-sdm-boosted-regression-trees-from-scratch-ish" class="nav-link" data-scroll-target="#a-more-complex-sdm-boosted-regression-trees-from-scratch-ish">A more complex SDM – Boosted Regression Trees from scratch(-ish)</a>
  <ul class="collapse">
  <li><a href="#fitting-a-decision-tree" id="toc-fitting-a-decision-tree" class="nav-link" data-scroll-target="#fitting-a-decision-tree">Fitting a Decision Tree</a></li>
  <li><a href="#making-a-random-forest" id="toc-making-a-random-forest" class="nav-link" data-scroll-target="#making-a-random-forest">Making a random forest</a></li>
  <li><a href="#boosting-to-create-a-brt" id="toc-boosting-to-create-a-brt" class="nav-link" data-scroll-target="#boosting-to-create-a-brt">Boosting to create a BRT</a></li>
  </ul></li>
  <li><a href="#explaining-an-brts-predictions" id="toc-explaining-an-brts-predictions" class="nav-link" data-scroll-target="#explaining-an-brts-predictions">Explaining an BRT’s predictions</a>
  <ul class="collapse">
  <li><a href="#partial-responses" id="toc-partial-responses" class="nav-link" data-scroll-target="#partial-responses">Partial Responses</a></li>
  <li><a href="#shap-values" id="toc-shap-values" class="nav-link" data-scroll-target="#shap-values">SHAP Values</a></li>
  <li><a href="#conformal-prediction" id="toc-conformal-prediction" class="nav-link" data-scroll-target="#conformal-prediction">Conformal Prediction</a></li>
  <li><a href="#counterfactuals" id="toc-counterfactuals" class="nav-link" data-scroll-target="#counterfactuals">Counterfactuals</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#what-if-i-want-to-use-a-different-model" id="toc-what-if-i-want-to-use-a-different-model" class="nav-link" data-scroll-target="#what-if-i-want-to-use-a-different-model">What if I want to use a different model?</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.ipynb" download="index.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Interpretable machine learning for species distribution modeling</h1>
<p class="subtitle lead">CSEE 2025 Workshop</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Michael D. Catchen <a href="https://orcid.org/0000-0002-6506-6487" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Timothée Poisot <a href="https://orcid.org/0000-0002-0735-5184" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Gabriel Dansereau <a href="https://orcid.org/0000-0002-2212-3584" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
             <p>Ariane Bussières-Fournel </p>
          </div>
  </div>
    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p><strong>To do.</strong></p>
  </div>
</div>


</header>


<section id="todo-list" class="level1">
<h1><strong>TODO LIST</strong></h1>
<ul>
<li>Decide on species to align with abstract</li>
<li>Boosting merged and utilized</li>
<li>RF w/ thresholding gives map w/ 0s, 1s, and a small number of 0.5s</li>
<li><code>mask(presences, poly)</code> requires rewrapping it in an Occurrence object. See no downside in always doing this by default?</li>
</ul>
</section>
<section id="setup-packages" class="level1">
<h1>Setup Packages</h1>
<div id="2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(<span class="pp">@__DIR__</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">1234567</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Activating project at `~/Code/Workspaces/InterpretableSDMs_CSEE2025`</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>TaskLocalRNG()</code></pre>
</div>
</div>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">SpeciesDistributionToolkit</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">PrettyTables</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> SDT <span class="op">=</span> SpeciesDistributionToolkit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>SpeciesDistributionToolkit</code></pre>
</div>
</div>
</section>
<section id="getting-started" class="level1 page-columns page-full">
<h1>Getting Started</h1>
<p>In this tutorial, we are going to build a species distribution model (SDM) for the species <a href="https://en.wikipedia.org/wiki/Ring_ouzel"><em>Turdus torquatus</em></a>, a European thrush that has breeding grounds in the French, Swiss, and Italian alps. We’ll particularly only focus on modeling its range in Switzerland, to present <code>SpeciesDistributionToolkit</code>’s abilities for working with polygons for countries and their subdivisions.</p>
<p><a href="https://poisotlab.github.io/SpeciesDistributionToolkit.jl/v1.6.3/">SpeciesDistributionToolkit.jl (SDT)</a> is a package we (the authors) have developed over several years for working with species distribution data, fitting SDMs with various machine learning methods, and tools for interpreting these models. You can read the (recently acceptedin PCI Ecology) preprint <a href="">here</a>.</p>
<p>Specifically, <strong>SDT</strong> is a <a href="https://monorepo.tools/"><em>monorepo</em></a>, composed of many subpackages — the ones we’ll use here are:</p>
<ul>
<li><strong>SimpleSDMLayers</strong>: for manipulating raster data</li>
<li><strong>SimpleSDMDatasets</strong>: for querying and downloading raster data from a variety of databases</li>
<li><strong>SimpleSDMPolygons</strong>: for querying and manipulating polygon data from a variety of databases</li>
<li><strong>GBIF</strong>: for downloading data from the <a href="https://www.gbif.org/">Global Biodiversity Information Facility</a></li>
<li><strong>Phylopic.jl</strong>: for downloading taxon silhouettes to add to data visualization</li>
<li><strong>SDeMo.jl</strong>: a high-level interface for training, validating, and interpreting species distribution models</li>
</ul>
<section id="downloading-polygon-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="downloading-polygon-data">Downloading Polygon Data</h2>
<p>Let’s start by downloading a polygon for the border of Switzerland.</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>osm_provider <span class="op">=</span> <span class="fu">PolygonData</span>(OpenStreetMap, Places)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>switzerland <span class="op">=</span> <span class="fu">getpolygon</span>(osm_provider, place<span class="op">=</span><span class="st">"Switzerland"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>FeatureCollection with 1 features, each with 0 properties</code></pre>
</div>
</div>
<p>We can confirm we downloaded the right data by visualizing it. All visualizations in this tutorial will use the <a href="https://docs.makie.org/stable/"><code>Makie</code></a> library<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Makie uses various “backends” to produce figures, depending on the desired output format. We ran <code>using CairoMakie</code> to use the <code>Cairo</code> backend, which is used for producing publication quality PNGs and vector graphics.</p></div></div><div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(switzerland)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-5-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looks good! Now we’ll load the environmental data we’ll use.</p>
</section>
<section id="downloading-environmental-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="downloading-environmental-data">Downloading Environmental Data</h2>
<p>We’ll download environment data from CHELSA, which provides 19 bioclimatic layers at 1km<span class="math inline">\(^2\)</span> resolution. The interface for downloading raster data is similar to polygon data — first we define a <code>RasterData</code> provider[^rasterdata] which takes in the database (<code>CHELSA2</code>) and particular dataset (<code>BioClim</code>) to download.</p>
<p><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>: A full list of databases, and the datasets they provide, is available <a href="https://poisotlab.github.io/SpeciesDistributionToolkit.jl/v1.6.3/howto/list-provided-layers#SimpleSDMDatasets.RasterDataset-howto-list-provided-layers">here</a>, and in the “Datasets” tab in the top navigation bar.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;rasterdata</p></div></div><div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>chelsa_provider <span class="op">=</span> <span class="fu">RasterData</span>(CHELSA2, BioClim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>RasterData{CHELSA2, BioClim}(CHELSA2, BioClim)</code></pre>
</div>
</div>
<p>We can use the <code>layerdescriptions</code> method to list the names of all of the layers provided by <code>chelsa_provider</code>, along with their descriptions.</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layerdescriptions</span>(chelsa_provider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Dict{String, String} with 19 entries:
  "BIO8"  =&gt; "Mean Temperature of Wettest Quarter"
  "BIO14" =&gt; "Precipitation of Driest Month"
  "BIO16" =&gt; "Precipitation of Wettest Quarter"
  "BIO18" =&gt; "Precipitation of Warmest Quarter"
  "BIO19" =&gt; "Precipitation of Coldest Quarter"
  "BIO10" =&gt; "Mean Temperature of Warmest Quarter"
  "BIO12" =&gt; "Annual Precipitation"
  "BIO13" =&gt; "Precipitation of Wettest Month"
  "BIO2"  =&gt; "Mean Diurnal Range (Mean of monthly (max temp - min temp))"
  "BIO11" =&gt; "Mean Temperature of Coldest Quarter"
  "BIO6"  =&gt; "Min Temperature of Coldest Month"
  "BIO4"  =&gt; "Temperature Seasonality (standard deviation ×100)"
  "BIO17" =&gt; "Precipitation of Driest Quarter"
  "BIO7"  =&gt; "Temperature Annual Range (BIO5-BIO6)"
  "BIO1"  =&gt; "Annual Mean Temperature"
  "BIO5"  =&gt; "Max Temperature of Warmest Month"
  "BIO9"  =&gt; "Mean Temperature of Driest Quarter"
  "BIO3"  =&gt; "Isothermality (BIO2/BIO7) (×100)"
  "BIO15" =&gt; "Precipitation Seasonality (Coefficient of Variation)"</code></pre>
</div>
</div>
<p>To download a layer, we use the <code>SDMLayer</code> constructor, and pass the specific name of the we want <code>layer</code> keyword argument. We also pass the bounding box of the region we want with the <code>left</code>, <code>right</code>, <code>bottom</code> and <code>top</code> keywords.</p>
<p>For example, to download BIO1 (mean annual temperature) at longitudes from 40° to 43°, and latitudes from 30° to 35°, we run</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">SDMLayer</span>(chelsa_provider, layer<span class="op">=</span><span class="st">"BIO1"</span>, left<span class="op">=</span><span class="fl">40</span>, right<span class="op">=</span><span class="fl">43</span>, bottom<span class="op">=</span><span class="fl">30</span>, top<span class="op">=</span><span class="fl">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 601 × 361 layer with 216961 UInt16 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>We want to download each layer for the bounding box of Switzerland. We can obtain this by using the <code>boundingbox</code> method<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Note that we use <code>SDT.boundingbox</code> because <code>boundingbox</code> shares a name with another method in <code>CairoMakie</code>, so we have to specificy which <code>boundingbox</code> method we mean.</p></div></div><div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>SDT.<span class="fu">boundingbox</span>(switzerland)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(left = 5.955911159515381, right = 10.492294311523438, bottom = 45.81795883178711, top = 47.80845260620117)</code></pre>
</div>
</div>
<p>Note that this returns a named-tuple with each coordinate named in the same way we need them for downloading a layer. This allows us to directly input the result of <code>SDT.boundingbox</code> into <code>SDMLayer</code> using splatting<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, e.g.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;<a href="https://docs.julialang.org/en/v1/base/base/#..."><em>Splatting</em></a> refers to adding <code>...</code> after a collection of items (like a vector or tuple), which results in them each being processed as sequential arguments. For example, if <code>x=[1,2,3]</code> and you call <code>f(x...)</code>, this is equivalent to <code>f(1,2,3)</code>.</p></div></div><div id="18" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">SDMLayer</span>(chelsa_provider; layer<span class="op">=</span><span class="st">"BIO1"</span>, SDT.<span class="fu">boundingbox</span>(switzerland)<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 131040 UInt16 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>We can then load all 19 bioclimatic variables by using <code>layers</code>, which returns a list of the names of each layer provided by <code>chelsa_provider</code>, e.g.</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">layers</span>(chelsa_provider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>19-element Vector{String}:
 "BIO1"
 "BIO2"
 "BIO3"
 "BIO4"
 "BIO5"
 "BIO6"
 "BIO7"
 "BIO8"
 "BIO9"
 "BIO10"
 "BIO11"
 "BIO12"
 "BIO13"
 "BIO14"
 "BIO15"
 "BIO16"
 "BIO17"
 "BIO18"
 "BIO19"</code></pre>
</div>
</div>
<p>We can then load them all in a single line using an in-line for loop.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note on downloading and storing layers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note that the first time you run the following lines, the entirety of each layer will be downloaded and cached. This means the first time you run this line, it will take several minutes, but every subsequent time will be nearly instant, because the layers are saved in SimpleSDMDataset’s cache (by default, this is located in <code>~/.julia/SimpleSDMDatasets/</code>).</p>
</div>
</div>
</div>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>env_covariates <span class="op">=</span> SDMLayer{<span class="dt">Float32</span>}[</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SDMLayer</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        chelsa_provider; </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        layer <span class="op">=</span> layername,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        SDT.<span class="fu">boundingbox</span>(switzerland)<span class="op">...</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    for layername <span class="kw">in</span> <span class="fu">layers</span>(chelsa_provider)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>19-element Vector{SDMLayer{Float32}}:
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)
 🗺️  A 240 × 546 layer (131040 Float32 cells)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Other ways to iterate over the layers we want to download
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note that there are many different ways to do iteration in Julia, not just the in-line for loop used above.</p>
<div id="24" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Using a conventional for loop with indices</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>env_covariates <span class="op">=</span> SDMLayer{<span class="dt">Float32</span>}[]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">19</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(env_covariates, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SDMLayer</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>            chelsa_provider; </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>            layer <span class="op">=</span> <span class="st">"BIO</span><span class="sc">$</span>i<span class="st">"</span>, </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>            SDT.<span class="fu">boundingbox</span>(switzerland)<span class="op">...</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="26" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Using <code>map</code> with layer names</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>env_covariates <span class="op">=</span> <span class="fu">map</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    layername <span class="op">-&gt;</span> <span class="fu">Float32</span>.(<span class="fu">SDMLayer</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>        chelsa_provider; </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        layer <span class="op">=</span> layername,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        SDT.<span class="fu">boundingbox</span>(switzerland)<span class="op">...</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layers</span>(chelsa_provider)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Now we can visualize the first layer, and our polygon. We’ll plot the first environmental layer with <code>heatmap</code>, and we’ll pass <code>color=:white</code> and <code>linewidth=3</code> to make our polygon easier to see.</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(env_covariates[begin])</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(switzerland, color<span class="op">=:</span>white, linewidth<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-15-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that although our raster has the same extent as our polygon, it extends outside our polygon’s border. We can fix this with the <code>mask!</code> method.</p>
<section id="masking-the-environmental-layers" class="level3">
<h3 class="anchored" data-anchor-id="masking-the-environmental-layers">Masking the environmental layers</h3>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mask!</span>(env_covariates, switzerland)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>19-element Vector{SDMLayer{Float32}}:
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)</code></pre>
</div>
</div>
<p>and we can verify this worked by plotting it again:</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(env_covariates[begin])</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(switzerland, color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-17-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Let’s plot a few of them.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plotting multiple layers
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>layers_to_plot <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">12</span>, <span class="fl">15</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i,ci) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">CartesianIndices</span>((<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>)))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    this_layer <span class="op">=</span> <span class="fu">layers</span>(chelsa_provider)[layers_to_plot[i]]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        f[ci[<span class="fl">1</span>], ci[<span class="fl">2</span>]], </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="fu">layerdescriptions</span>(chelsa_provider)[this_layer], </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        titlesize<span class="op">=</span><span class="fl">12</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">heatmap!</span>(ax, env_covariates[layers_to_plot[i]])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hidespines!</span>(ax)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="36" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-19-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="downloading-occurrence-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-occurrence-data">Downloading occurrence data</h2>
<p>Now we’ll use the <strong>GBIF.jl</strong> subpackage to download occurrence data from the Global Biodiversity Information Facility (<a href="https://www.gbif.org/">GBIF</a>) for our species, <em>Turdus torquatus</em>. We do this with the <code>taxon</code> method.</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ouzel <span class="op">=</span> <span class="fu">taxon</span>(<span class="st">"Turdus torquatus"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>GBIF taxon -- Turdus torquatus</code></pre>
</div>
</div>
<p>We’ll then use the <code>occurrences</code> method to setup a data download from GBIF. We pass the taxon, <code>ouzel</code>, and an environmental covariate (with <code>first(env_covariates)</code>) representing the extent from which we want to download occurrences. The function also takes keyword arguments that are specified in the <a href="https://techdocs.gbif.org/en/openapi/v1/occurrence">GBIF API</a>.</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>presences <span class="op">=</span> <span class="fu">occurrences</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    ouzel,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">first</span>(env_covariates),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"occurrenceStatus"</span> <span class="op">=&gt;</span> <span class="st">"PRESENT"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"limit"</span> <span class="op">=&gt;</span> <span class="fl">300</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"country"</span> <span class="op">=&gt;</span> <span class="st">"CH"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"datasetKey"</span> <span class="op">=&gt;</span> <span class="st">"4fa7b334-ce0d-4e88-aaae-2e0c138d049e"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>GBIF records: downloaded 300 out of 1404</code></pre>
</div>
</div>
<p>Note that this only downloads the first 300 occurrences, because the total number of records can vary drastically depending on the species and extent, and the GBIF streaming API has a hard limit at 200000 records, and querying large amounts of using the streaming API is woefully inefficient. For data volumes above 10000 observations, the suggested solution is to rely on the download interface on GBIF.</p>
<p>We can use the <code>count</code> method to determine how many total records match our criteria</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(presences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>1404</code></pre>
</div>
</div>
<p>Because this is a reasonable number, we can download the rest of the occurrences using a while loop, and a the <code>occurrences!</code> method to iterate and download the remaining occurrences.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="fu">length</span>(presences) <span class="op">&lt;</span> <span class="fu">count</span>(presences)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">occurrences!</span>(presences)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>GBIF has a built-in Table.jl API, which means we can easily convert the occurrence records to a <code>DataFrame</code>:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DataFrame</span>(presences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div><div style="float: left;"><span>1404×29 DataFrame</span></div><div style="float: right;"><span style="font-style: italic;">1379 rows omitted</span></div><div style="clear: both;"></div></div><div class="data-frame" style="overflow-x: scroll;">
<table class="data-frame caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">key</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">datasetKey</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">dataset</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">publishingOrgKey</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">publishingCountry</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">institutionCode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">protocol</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">countryCode</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">basisOfRecord</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">individualCount</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">precision</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">uncertainty</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">geodetic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">identified</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">issues</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">taxonKey</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rank</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">taxon</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">generic</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">epithet</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">vernacular</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">scientific</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">observer</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">license</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">presence</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Missing">Missing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Symbol">Symbol</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Int64}">Int64?</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Missing">Missing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Missing">Missing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Missing">Missing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Missing">Missing</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Vector{Symbol}">Array…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="GBIF.GBIFTaxon">GBIFTaxon</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Bool">Bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">4709728505</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.3404</td>
<td style="text-align: right;">7.63405</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr788756</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">4631294555</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">47.1648</td>
<td style="text-align: right;">9.19779</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1473331</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">4717153698</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.3878</td>
<td style="text-align: right;">8.02234</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1538171</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">4703405324</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.3878</td>
<td style="text-align: right;">8.02234</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr2869500</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: right;">4698992061</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">47.1861</td>
<td style="text-align: right;">9.35102</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr2670291</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">6</td>
<td style="text-align: right;">4611055512</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">46.8433</td>
<td style="text-align: right;">7.98554</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr2692703</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">7</td>
<td style="text-align: right;">4794340181</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.5887</td>
<td style="text-align: right;">6.17083</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1538171</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">8</td>
<td style="text-align: right;">4639401120</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">46.8154</td>
<td style="text-align: right;">9.76794</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1473331</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">9</td>
<td style="text-align: right;">4779612275</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">46.7888</td>
<td style="text-align: right;">6.488</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr109021</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">10</td>
<td style="text-align: right;">4723809355</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">47.0041</td>
<td style="text-align: right;">9.50994</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr2900560</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">11</td>
<td style="text-align: right;">4724185634</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">46.9023</td>
<td style="text-align: right;">8.67436</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:COORDINATE_ROUNDED, :CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1586679</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">12</td>
<td style="text-align: right;">4799483908</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">46.7945</td>
<td style="text-align: right;">9.67675</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr3040942</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">13</td>
<td style="text-align: right;">4798123478</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">46.6092</td>
<td style="text-align: right;">6.21726</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr2670291</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1393</td>
<td style="text-align: right;">4320365329</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">46.3899</td>
<td style="text-align: right;">8.06182</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1479734</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1394</td>
<td style="text-align: right;">258866137</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">46.0135</td>
<td style="text-align: right;">7.74446</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr17450</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1395</td>
<td style="text-align: right;">258565537</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">46.5014</td>
<td style="text-align: right;">9.8353</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr17450</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1396</td>
<td style="text-align: right;">3292306100</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.3063</td>
<td style="text-align: right;">8.01213</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr904825</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1397</td>
<td style="text-align: right;">1791714342</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">46.6925</td>
<td style="text-align: right;">9.40155</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr439300</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1398</td>
<td style="text-align: right;">602573529</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">46.6035</td>
<td style="text-align: right;">8.51234</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr86442</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1399</td>
<td style="text-align: right;">3281963623</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.3063</td>
<td style="text-align: right;">8.01213</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr904825</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1400</td>
<td style="text-align: right;">2127587072</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">46.5866</td>
<td style="text-align: right;">7.9605</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr137776</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1401</td>
<td style="text-align: right;">2793845474</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.5223</td>
<td style="text-align: right;">6.94705</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr293417</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1402</td>
<td style="text-align: right;">2726803858</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.6671</td>
<td style="text-align: right;">10.1934</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1051392</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1403</td>
<td style="text-align: right;">2792111865</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">45.992</td>
<td style="text-align: right;">7.70887</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr201030</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1404</td>
<td style="text-align: right;">2799732429</td>
<td style="text-align: left;">4fa7b334-ce0d-4e88-aaae-2e0c138d049e</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">e2e717bf-551a-4917-bdc9-4fa0f342c530</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">CLO</td>
<td style="text-align: left;">DWC_ARCHIVE</td>
<td style="text-align: left;">CH</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">HUMAN_OBSERVATION</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right;">46.5591</td>
<td style="text-align: right;">7.89209</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">WGS84</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: right; font-style: italic;">missing</td>
<td style="text-align: left;">[:CONTINENT_DERIVED_FROM_COORDINATES, :TAXON_MATCH_TAXON_CONCEPT_ID_IGNORED]</td>
<td style="text-align: right;">7865305</td>
<td style="text-align: left;">SPECIES</td>
<td style="text-align: left;">GBIF taxon -- Turdus torquatus\n</td>
<td style="text-align: left;">Turdus</td>
<td style="text-align: left;">torquatus</td>
<td style="text-align: left;">Ring Ouzel</td>
<td style="text-align: left;">Turdus torquatus Linnaeus, 1758</td>
<td style="text-align: left;">obsr1426731</td>
<td style="text-align: left;">http://creativecommons.org/licenses/by/4.0/legalcode</td>
<td style="text-align: right;">true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>However, SDeMo is designed to work with the result from GBIF directly. For example, we can plot them with <code>scatter!</code></p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(switzerland)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(presences)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-25-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can also convert the occurrences into a raster with <code>true</code> values at the location of occurrences using the <code>mask</code> function. This will be useful for us in the next section.</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>presencelayer <span class="op">=</span> <span class="fu">mask</span>(<span class="fu">first</span>(env_covariates), presences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Bool cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
</section>
<section id="computing-statistics-with-occurrences" class="level2">
<h2 class="anchored" data-anchor-id="computing-statistics-with-occurrences">Computing statistics with occurrences</h2>
<p>Here, we’ll show how we can work with occurrence data and polygons. First, we’ll download data on the Swiss cantons (states), using the GADM polygon database.</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gadm_provider <span class="op">=</span> <span class="fu">PolygonData</span>(GADM, Countries)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>swiss_states <span class="op">=</span> <span class="fu">getpolygon</span>(gadm_provider; country<span class="op">=</span><span class="st">"CHE"</span>, level<span class="op">=</span><span class="fl">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>FeatureCollection with 26 features, each with 2 properties</code></pre>
</div>
</div>
<p>Next we’ll plot each state along with presence records.</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(switzerland, color<span class="op">=:</span>black)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(swiss_states, color<span class="op">=:</span>grey60)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(presencelayer)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-28-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Next we’ll use the <code>byzone</code> method to compute the total number of presences in each state. We pass <code>sum</code> as the method to apply to each region, and <code>presencelayer</code> as the layer to apply <code>sum</code> to.</p>
<div id="56" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>pres_per_state <span class="op">=</span> <span class="fu">Dict</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">byzone</span>(sum, presencelayer, [x for x <span class="kw">in</span> swiss_states], [x.properties[<span class="st">"Name"</span>] for x <span class="kw">in</span> swiss_states])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Dict{String, Int64} with 24 entries:
  "Genève"           =&gt; 0
  "Uri"              =&gt; 29
  "Ticino"           =&gt; 37
  "Thurgau"          =&gt; 0
  "Zug"              =&gt; 0
  "Schwyz"           =&gt; 13
  "Lucerne"          =&gt; 20
  "Obwalden"         =&gt; 24
  "Vaud"             =&gt; 56
  "Nidwalden"        =&gt; 10
  "SanktGallen"      =&gt; 68
  "Graubünden"       =&gt; 164
  "Neuchâtel"        =&gt; 4
  "Bern"             =&gt; 93
  "Fribourg"         =&gt; 29
  "Basel-Landschaft" =&gt; 1
  "Aargau"           =&gt; 0
  "Zürich"           =&gt; 1
  "Valais"           =&gt; 134
  ⋮                  =&gt; ⋮</code></pre>
</div>
</div>
<p>Finally, we’ll plot the total number of occurrences in each state as a bar chart.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plotting presences by state
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="58" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>presence_cts <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">values</span>(pres_per_state))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>sort_idx <span class="op">=</span> <span class="fu">sortperm</span>(presence_cts)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>state_names <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">keys</span>(pres_per_state))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    f[<span class="fl">1</span>,<span class="fl">1</span>], </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    xlabel <span class="op">=</span> <span class="st">"Number of Occurrences"</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    ylabel <span class="op">=</span> <span class="st">"State"</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    yticks<span class="op">=</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(state_names), state_names[sort_idx])</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot!</span>(ax, presence_cts[sort_idx], direction<span class="op">=:</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Plot{barplot, Tuple{Vector{Point{2, Float64}}}}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="60" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-31-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="associating-environmental-covariates-with-occurrences" class="level2">
<h2 class="anchored" data-anchor-id="associating-environmental-covariates-with-occurrences">Associating Environmental Covariates with Occurrences</h2>
<p>Next, we’ll show how we associate the data in our environmental covariates with each occurrence point. First, let’s select the environmental covariates that represent mean annual temperature (BIO1), and annual precipitation (BIO12).</p>
<div id="62" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>temperature, precipitation <span class="op">=</span> env_covariates[[<span class="fl">1</span>,<span class="fl">12</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>2-element Vector{SDMLayer{Float32}}:
 🗺️  A 240 × 546 layer (70065 Float32 cells)
 🗺️  A 240 × 546 layer (70065 Float32 cells)</code></pre>
</div>
</div>
<p>We can simply index the layers by the <code>presences</code> object to select the value of the covariate at each location.</p>
<div id="64" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>temp, precip <span class="op">=</span> temperature[presences], precipitation[presences]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(Float32[2779.0, 2767.0, 2741.0, 2741.0, 2775.0, 2760.0, 2798.0, 2731.0, 2795.0, 2828.0  …  2736.0, 2802.0, 2785.0, 2762.0, 2802.0, 2734.0, 2796.0, 2739.0, 2714.0, 2763.0], Float32[12204.0, 25308.0, 16461.0, 16461.0, 20484.0, 20710.0, 18301.0, 17158.0, 16509.0, 10499.0  …  15375.0, 10211.0, 11675.0, 22840.0, 10211.0, 20742.0, 17484.0, 11090.0, 16431.0, 18676.0])</code></pre>
</div>
</div>
<p>Note that CHELSA doesn’t provide data in commonly used units — the transformations to convert them into typical units can be found in their [documentation]. The relevant transformations for temperature and precipitation are applied below.</p>
<pre><code>temp = 0.1temp .- 271
precip = 0.1precip</code></pre>
<p>Finally, we can add a silhoutte of our taxon to the plot by downloading it using the Phylopic subpackage.</p>
<div id="66" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>taxon_silhoeutte <span class="op">=</span> Phylopic.<span class="fu">imagesof</span>(ouzel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>PhylopicSilhouette("Turdus migratorius", Base.UUID("7be55586-e993-4eb3-88a0-9ec7a2ba0c7d"))</code></pre>
</div>
</div>
<p>This can all be visualized using the code below, which shows a clear negative correlation between temperature and precipitation at the occurrence locations.</p>
<div id="68" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    f[<span class="fl">1</span>,<span class="fl">1</span>], </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">"Annual mean temperature (°C)"</span>, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    ylabel<span class="op">=</span><span class="st">"Annual precipitation (kg×m⁻²)"</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(ax, <span class="fl">0.1</span>temperature[presences]<span class="op">.-</span><span class="fl">271</span>, <span class="fl">0.1</span>precipitation[presences], color<span class="op">=</span>(<span class="op">:</span>seagreen4, <span class="fl">0.7</span>))</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">silhouetteplot!</span>(ax, <span class="op">-</span><span class="fl">5</span>., <span class="fl">1000.0</span>, taxon_silhoeutte; markersize<span class="op">=</span><span class="fl">70</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-35-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="building-a-simple-species-distribution-model" class="level1 page-columns page-full">
<h1>Building a Simple Species Distribution Model</h1>
<p>Now that we have obtained both occurrence and environmental data, and explored it, we are ready to fit a species distribution model.</p>
<p>The <strong>SDeMo</strong> subpackage provides methods for data preparation, training, validation, and interpretation, as well as several built-in models. Before we fit a more complicated machine-learning model, we’ll start by beocming familiar with the <strong>SDeMo</strong> API using a simpler model, the <em>Naive-Bayes classifier</em>.</p>
<section id="sampling-pseudo-absences" class="level2">
<h2 class="anchored" data-anchor-id="sampling-pseudo-absences">Sampling Pseudo-Absences</h2>
<p>All of the models we use for binary classification, including <em>Naive-Bayes</em>, require presence-absence data. However, for the vast majority of species, we don’t have records of true species absences because these typically expensive monitoring programs, in contrast to the widespread availability of presence data on GBIF, which is largely crowdsourced from community science platforms like <em>iNaturalist</em>.</p>
<p>To deal with this, a widespread method is generating <em>pseudo</em>-absences, which rely on hueristics to select sites where it is <em>very unlikely</em> that the target species is present. There is a deep literature on methods to select the locations and number of pseudoabsences (<strong>tk cites</strong>). Here we will use a method called <em>background thickening</em>, which means the probability a given location is marked as a pseudoabsence grows with the <em>minimum</em> distance to nearest presence.</p>
<p>We can implement background thickening this using the <code>pseudoabsencemask</code> method, first with the <code>DistanceToEvent</code> technique, which generates a layer where each value is the distance (in kilometers) to the nearest presence record.</p>
<div id="70" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>background <span class="op">=</span> <span class="fu">pseudoabsencemask</span>(DistanceToEvent, presencelayer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>We can then visualize this using <code>heatmap</code>.</p>
<div id="72" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(background)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-37-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We <em>could</em> draw pseudoabsences from this, but it is also typically a good idea to add a <em>buffer</em> around each presence, which are not allowed to include pseudoabsences. The justification for this is it’s unlikely to be truly absent in locations very close to an observed presence. Here, we’ll use a buffer distance of 4 kilometers, and mask those regions out using the <code>nodata</code> method.</p>
<div id="74" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>buffer_distance <span class="op">=</span> <span class="fl">4</span> <span class="co"># In kilometers</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>buffered_background <span class="op">=</span> <span class="fu">nodata</span>(background, d <span class="op">-&gt;</span> d <span class="op">&lt;</span> buffer_distance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 45448 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>Finally, we’ll sample pseudoabsences using the <code>backgroundpoints</code> method. We’ll choose to sample twice as many pseudoabsences as there are presences. In real workflows, it’ important to determine the sensitivity of a model to the number of pseudoabsences, but given this tutorial is focused on interpretable machine learning, we’ll stick with number of pseudoabsences for each example.</p>
<div id="76" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>num_pseudoabsences <span class="op">=</span> <span class="fl">2</span><span class="fu">sum</span>(presencelayer)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pseudoabsences <span class="op">=</span> <span class="fu">backgroundpoints</span>(buffered_background, num_pseudoabsences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 45448 Bool cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>Finally, we can visualize the pseudoabsences using <code>scatter!</code>, just as we would for presences. Below, presences are in orange, and pseudoabsences are in grey.</p>
<div id="78" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(switzerland, color<span class="op">=:</span>black)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(presencelayer, color<span class="op">=</span>colorant<span class="st">"#e79154"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(pseudoabsences, color<span class="op">=</span>colorant<span class="st">"#bbb"</span>, markersize<span class="op">=</span><span class="fl">5</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-40-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see there is a clear geographic distinction in the regions where presences and absences are, but crucially we need them to be if different regions of environmental space.</p>
<p>We visualize the density of presences and absences in environmental space below.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code for plotting density in environmental space
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cell-fig-classification-separability" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>abcol <span class="op">=</span> colorant<span class="st">"#bbb"</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>prcol <span class="op">=</span> colorant<span class="st">"#e79154"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>_range <span class="op">=</span> (</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    absent <span class="op">=</span> abcol,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    present <span class="op">=</span> prcol,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    absentbg <span class="op">=</span> (abcol, <span class="fl">0.2</span>),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    presentbg <span class="op">=</span> (prcol, <span class="fl">0.2</span>),</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>bkcol <span class="op">=</span> (</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    nodata <span class="op">=</span> colorant<span class="st">"#DDDDDD"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    generic <span class="op">=</span> colorant<span class="st">"#222222"</span>,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    sdm <span class="op">=</span> _range,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>temp_idx, precip_idx <span class="op">=</span> <span class="fl">1</span>, <span class="fl">12</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>tmp, precip <span class="op">=</span> <span class="fl">0.1</span>env_covariates[temp_idx] <span class="op">-</span> <span class="fl">273.15</span>, <span class="fl">0.1</span>env_covariates[precip_idx]</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>temp_pres <span class="op">=</span> tmp.grid[presencelayer.grid]</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>temp_abs <span class="op">=</span> tmp.grid[pseudoabsences.grid]</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>precip_pres <span class="op">=</span> precip.grid[presencelayer.grid]</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>precip_abs <span class="op">=</span> precip.grid[pseudoabsences.grid]</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>gl <span class="op">=</span> f[<span class="fl">1</span>,<span class="fl">1</span>] <span class="op">=</span> <span class="fu">GridLayout</span>()</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>axtemp <span class="op">=</span> <span class="fu">Axis</span>(gl[<span class="fl">1</span>,<span class="fl">1</span>])</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="fu">density!</span>(axtemp, temp_pres, color<span class="op">=</span>bkcol.sdm.presentbg, strokecolor<span class="op">=</span>bkcol.sdm.present, strokewidth<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="fu">density!</span>(axtemp, temp_abs, color<span class="op">=</span>bkcol.sdm.absentbg, strokecolor<span class="op">=</span>bkcol.sdm.absent, strokewidth<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>axprec <span class="op">=</span> <span class="fu">Axis</span>(gl[<span class="fl">2</span>,<span class="fl">2</span>])</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="fu">density!</span>(axprec, precip_pres, color<span class="op">=</span>bkcol.sdm.presentbg, strokecolor<span class="op">=</span>bkcol.sdm.present, strokewidth<span class="op">=</span><span class="fl">1</span>, direction<span class="op">=:</span>y)</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="fu">density!</span>(axprec, precip_abs, color<span class="op">=</span>bkcol.sdm.absentbg, strokecolor<span class="op">=</span>bkcol.sdm.absent, strokewidth<span class="op">=</span><span class="fl">1</span>, direction<span class="op">=:</span>y)</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>axboth <span class="op">=</span> <span class="fu">Axis</span>(gl[<span class="fl">2</span>,<span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Mean air temperature (°C)"</span>, ylabel <span class="op">=</span> <span class="st">"Annual precipitation (kg m⁻²)"</span>)</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(axboth, temp_abs, precip_abs, color<span class="op">=</span>bkcol.sdm.absent, markersize<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"Pseudo-absence"</span>)</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(axboth, temp_pres, precip_pres, color<span class="op">=</span>bkcol.sdm.present, markersize<span class="op">=</span><span class="fl">4</span>, label<span class="op">=</span><span class="st">"Presence"</span>)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(position <span class="op">=</span> <span class="op">:</span>lb)</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(axtemp, <span class="op">:</span>l, <span class="op">:</span>r, <span class="op">:</span>t)</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(axprec, <span class="op">:</span>b, <span class="op">:</span>r, <span class="op">:</span>t)</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(axtemp, grid <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(axprec, grid <span class="op">=</span> <span class="cn">true</span>)</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ylims!</span>(axtemp, low <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a><span class="fu">xlims!</span>(axprec, low <span class="op">=</span> <span class="fl">0</span>)</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="fu">colgap!</span>(gl, <span class="fl">0</span>)</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="fu">rowgap!</span>(gl, <span class="fl">0</span>)</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="fu">colsize!</span>(gl, <span class="fl">1</span>, <span class="fu">Relative</span>(<span class="fl">5</span><span class="op">/</span><span class="fl">6</span>))</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="fu">rowsize!</span>(gl, <span class="fl">2</span>, <span class="fu">Relative</span>(<span class="fl">5</span><span class="op">/</span><span class="fl">6</span>))</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="fu">current_figure</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div id="fig-classification-separability" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-classification-separability-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-classification-separability-output-1.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-classification-separability-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: This figures show the separability of the presences and pseudo-absences on the temperature and precipitation dimensions.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="82" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-42-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="training-a-simple-sdm" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="training-a-simple-sdm">Training a Simple SDM</h2>
<p>Now that we have presences and pseudoabsences, we are finally ready to train our model.<strong>SDeMo</strong> uses a single <code>SDM</code> type that chains together the data transformation, the model, and data to fit on.</p>
<p>We’ll build a <em>Naive-Bayes</em> classifier that first applies Principal Component Analysis (PCA) <em>only to the training data</em><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;It’s crucial that PCA is only applied to the training data to avoid introducing <em>data leakage</em>.</p></div></div><div id="84" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nb_sdm <span class="op">=</span> <span class="fu">SDM</span>(PCATransform, NaiveBayes, env_covariates, presencelayer, pseudoabsences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>SDeMo.PCATransform → SDeMo.NaiveBayes → P(x) ≥ 0.5</code></pre>
</div>
</div>
<div id="86" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">train!</span>(nb_sdm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>SDeMo.PCATransform → SDeMo.NaiveBayes → P(x) ≥ 0.187</code></pre>
</div>
</div>
<div id="88" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>prd <span class="op">=</span> <span class="fu">predict</span>(nb_sdm, env_covariates; threshold <span class="op">=</span> <span class="cn">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Bool cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<div id="90" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">1</span>,<span class="fl">1</span>])</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap!</span>(ax, prd, colormap<span class="op">=</span>[<span class="op">:</span>grey75, <span class="op">:</span>seagreen4])</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(ax, presencelayer, color<span class="op">=:</span>white, markersize<span class="op">=</span><span class="fl">4</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-46-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="computing-roc-auc-and-pr-auc" class="level2">
<h2 class="anchored" data-anchor-id="computing-roc-auc-and-pr-auc">Computing ROC-AUC and PR-AUC</h2>
<div id="92" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>folds <span class="op">=</span> <span class="fu">kfold</span>(nb_sdm)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> <span class="fu">crossvalidate</span>(nb_sdm, folds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(validation = ConfusionMatrix[[TP: 68, TN 88, FP 50, FN 3], [TP: 64, TN 90, FP 46, FN 6], [TP: 64, TN 77, FP 60, FN 6], [TP: 66, TN 88, FP 49, FN 4], [TP: 61, TN 88, FP 48, FN 8], [TP: 63, TN 81, FP 56, FN 7], [TP: 68, TN 88, FP 49, FN 2], [TP: 65, TN 79, FP 58, FN 5], [TP: 63, TN 76, FP 60, FN 7], [TP: 61, TN 79, FP 58, FN 9]], training = ConfusionMatrix[[TP: 577, TN 750, FP 480, FN 52], [TP: 578, TN 754, FP 478, FN 52], [TP: 584, TN 736, FP 495, FN 46], [TP: 584, TN 743, FP 488, FN 46], [TP: 580, TN 750, FP 482, FN 51], [TP: 578, TN 779, FP 452, FN 52], [TP: 581, TN 738, FP 493, FN 49], [TP: 578, TN 754, FP 477, FN 52], [TP: 580, TN 758, FP 474, FN 50], [TP: 580, TN 784, FP 447, FN 50]])</code></pre>
</div>
</div>
<div id="94" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>measures <span class="op">=</span> [mcc, ppv, npv, plr, nlr]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>cvresult <span class="op">=</span> [<span class="fu">measure</span>(set) for measure <span class="kw">in</span> measures, set <span class="kw">in</span> cv]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>nullresult <span class="op">=</span> [<span class="fu">measure</span>(<span class="fu">null</span>(nb_sdm)) for measure <span class="kw">in</span> measures, null <span class="kw">in</span> [coinflip, noskill]]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pretty_table</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hcat</span>(<span class="fu">string</span>.(measures), <span class="fu">hcat</span>(cvresult, nullresult));</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    alignment <span class="op">=</span> [<span class="op">:</span>l, <span class="op">:</span>c, <span class="op">:</span>c, <span class="op">:</span>c, <span class="op">:</span>c],</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#backend = Val(:markdown),</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    header <span class="op">=</span> [<span class="st">"Measure"</span>, <span class="st">"Validation"</span>, <span class="st">"Training"</span>, <span class="st">"Coin-flip"</span>, <span class="st">"No-skill"</span>],</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    formatters <span class="op">=</span> <span class="fu">ft_printf</span>(<span class="st">"%5.3f"</span>, [<span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>]),</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>┌─────────┬────────────┬──────────┬───────────┬──────────┐
│ Measure │ Validation │ Training │ Coin-flip │ No-skill │
├─────────┼────────────┼──────────┼───────────┼──────────┤
│ mcc     │   0.505    │  0.510   │  -0.323   │  -0.000  │
│ ppv     │   0.547    │  0.549   │   0.338   │  0.338   │
│ npv     │   0.936    │  0.938   │   0.338   │  0.662   │
│ plr     │   2.378    │  2.381   │   0.512   │  1.000   │
│ nlr     │   0.136    │  0.129   │   1.954   │  1.000   │
└─────────┴────────────┴──────────┴───────────┴──────────┘</code></pre>
</div>
</div>
<div id="96" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>folds <span class="op">=</span> <span class="fu">kfold</span>(nb_sdm)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>thresholds <span class="op">=</span> <span class="fu">LinRange</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>, <span class="fl">50</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> [<span class="fu">crossvalidate</span>(nb_sdm, folds; thr <span class="op">=</span> t) for t <span class="kw">in</span> thresholds];</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="98" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: make these functions</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>SDT.SDeMo.<span class="fu">auc</span>([<span class="fu">tpr</span>(rep.validation) for rep <span class="kw">in</span> cv], ([<span class="fu">tnr</span>(rep.validation) for rep <span class="kw">in</span> cv]))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SDT.SDeMo.auc([tpr(rep.validation) for rep in cv], [ppv(rep.validation) for rep in cv], )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>0.8062856176441721</code></pre>
</div>
</div>
</section>
<section id="simple-explanations-partial-response" class="level2">
<h2 class="anchored" data-anchor-id="simple-explanations-partial-response">Simple Explanations: Partial Response</h2>
<div id="100" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>gl <span class="op">=</span> f[<span class="fl">1</span>,<span class="fl">1</span>] <span class="op">=</span> <span class="fu">GridLayout</span>()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>axtemp <span class="op">=</span> <span class="fu">Axis</span>(</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    gl[<span class="fl">1</span>,<span class="fl">1</span>], </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    xgridvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    ygridvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    xticksvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    xticklabelsvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    yticks<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, </span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    ylabel <span class="op">=</span> <span class="st">"Partial</span><span class="sc">\n</span><span class="st">Response"</span>, </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    ylabelrotation<span class="op">=</span><span class="fl">0</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>_, pr_p_thres <span class="op">=</span> <span class="fu">partialresponse</span>(nb_sdm, <span class="fu">variables</span>(nb_sdm)[<span class="fl">4</span>], threshold<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>τ <span class="op">=</span> <span class="fu">findfirst</span>(x<span class="op">-&gt;</span>x<span class="op">==</span><span class="fl">0</span>, pr_p_thres)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>pr_t_x, pr_t_y <span class="op">=</span> <span class="fu">partialresponse</span>(nb_sdm, <span class="fu">variables</span>(nb_sdm)[<span class="fl">4</span>], threshold<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="fu">xlims!</span>(axtemp, <span class="fu">extrema</span>(pr_t_x)<span class="op">...</span>)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ylims!</span>(axtemp, <span class="fl">0</span>, <span class="fl">1</span>)</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(axtemp, pr_t_x[<span class="fl">1</span><span class="op">:</span>τ], pr_t_y[<span class="fl">1</span><span class="op">:</span>τ], color<span class="op">=</span>bkcol.sdm.present, linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="fu">band!</span>(axtemp, pr_t_x[<span class="fl">1</span><span class="op">:</span>τ], [<span class="fl">0</span>. for _ <span class="kw">in</span> pr_t_y[<span class="fl">1</span><span class="op">:</span>τ]], pr_t_y[<span class="fl">1</span><span class="op">:</span>τ], color<span class="op">=</span>bkcol.sdm.presentbg)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(axtemp, pr_t_x[τ<span class="op">:</span><span class="kw">end</span>], pr_t_y[τ<span class="op">:</span><span class="kw">end</span>], color<span class="op">=</span>bkcol.sdm.absent, linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="fu">band!</span>(axtemp, pr_t_x[τ<span class="op">:</span><span class="kw">end</span>], [<span class="fl">0</span>. for _ <span class="kw">in</span> pr_t_y[τ<span class="op">:</span><span class="kw">end</span>]], pr_t_y[τ<span class="op">:</span><span class="kw">end</span>], color <span class="op">=</span> bkcol.sdm.absentbg)</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>axprec <span class="op">=</span> <span class="fu">Axis</span>(</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    gl[<span class="fl">2</span>,<span class="fl">2</span>], </span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>    xgridvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>    ygridvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>    yticksvisible<span class="op">=</span><span class="cn">false</span>, </span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>    yticklabelsvisible<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>    xticks<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, </span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">"Partial</span><span class="sc">\n</span><span class="st">Response"</span>,</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>    topspinecolor<span class="op">=</span>colorant<span class="st">"#999"</span>,</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>    leftspinecolor<span class="op">=</span>colorant<span class="st">"#999"</span>,</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>    rightspinecolor<span class="op">=</span>colorant<span class="st">"#999"</span>,</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>    bottomspinecolor<span class="op">=</span>colorant<span class="st">"#999"</span>,</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>pr_p_y, pr_p_x <span class="op">=</span> <span class="fu">partialresponse</span>(nb_sdm, <span class="fu">variables</span>(nb_sdm)[<span class="fl">12</span>], threshold<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(axprec, pr_p_x, pr_p_y, linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a><span class="fu">xlims!</span>(axprec, <span class="fl">0</span>, <span class="fl">1</span>)</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a><span class="fu">ylims!</span>(axprec, <span class="fu">extrema</span>(pr_p_y)<span class="op">...</span>)</span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>prx, pry, prz <span class="op">=</span> <span class="fu">partialresponse</span>(nb_sdm, <span class="fu">variables</span>(nb_sdm)[[<span class="fl">1</span>,<span class="fl">12</span>]]<span class="op">...</span>, (<span class="fl">50</span>, <span class="fl">100</span>); threshold <span class="op">=</span> <span class="cn">true</span>);</span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>prx <span class="op">=</span> <span class="fl">0.1</span>prx <span class="op">.-</span> <span class="fl">273.15</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a>pry <span class="op">=</span> <span class="fl">0.1</span>pry</span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a>axboth <span class="op">=</span> <span class="fu">Axis</span>(gl[<span class="fl">2</span>,<span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">"Mean air temperature (°C)"</span>, ylabel <span class="op">=</span> <span class="st">"Annual precipitation (kg m⁻²)"</span>)</span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a><span class="fu">limits!</span>(axboth, <span class="fu">extrema</span>(prx)<span class="op">...</span>, <span class="fu">extrema</span>(pry)<span class="op">...</span>)</span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap!</span>(axboth, prx, pry, prz, colormap<span class="op">=</span>[<span class="op">:</span>grey95, (bkcol.sdm.present, <span class="fl">0.2</span>)])</span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(axboth, temp_abs, precip_abs, color<span class="op">=</span>bkcol.sdm.absent, markersize<span class="op">=</span><span class="fl">6</span>, label<span class="op">=</span><span class="st">"Pseudo-absence"</span>)</span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter!</span>(axboth, temp_pres, precip_pres, color<span class="op">=</span>bkcol.sdm.present, markersize<span class="op">=</span><span class="fl">6</span>, label<span class="op">=</span><span class="st">"Presence"</span>)</span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a><span class="fu">axislegend</span>(position <span class="op">=</span> <span class="op">:</span>lb)</span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(axtemp, <span class="op">:</span>b)</span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(axprec, <span class="op">:</span>l)</span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a><span class="fu">colgap!</span>(gl, <span class="fl">7</span>)</span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a><span class="fu">rowgap!</span>(gl, <span class="fl">7</span>)</span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a><span class="fu">colsize!</span>(gl, <span class="fl">1</span>, <span class="fu">Relative</span>(<span class="fl">5</span><span class="op">/</span><span class="fl">6</span>))</span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a><span class="fu">rowsize!</span>(gl, <span class="fl">2</span>, <span class="fu">Relative</span>(<span class="fl">5</span><span class="op">/</span><span class="fl">6</span>))</span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-71"><a href="#cb79-71" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-51-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="a-more-complex-sdm-boosted-regression-trees-from-scratch-ish" class="level1">
<h1>A more complex SDM – Boosted Regression Trees from scratch(-ish)</h1>
<p>TODO: What is a BRT explanation: - What is a decision tree? - Decision Tree + Bagging = Random Forest - Random Forest + Boosting = BRT</p>
<section id="fitting-a-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="fitting-a-decision-tree">Fitting a Decision Tree</h2>
<div id="102" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dt_sdm <span class="op">=</span> <span class="fu">SDM</span>(ZScore, DecisionTree, env_covariates, presencelayer, pseudoabsences)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>SDeMo.ZScore → SDeMo.DecisionTree → P(x) ≥ 0.5</code></pre>
</div>
</div>
<div id="104" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="fu">variables!</span>(dt_sdm, ForwardSelection, <span class="fu">kfold</span>(dt_sdm, k<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  2.621942 seconds (18.40 M allocations: 2.197 GiB, 6.21% gc time)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>SDeMo.ZScore → SDeMo.DecisionTree → P(x) ≥ 0.586</code></pre>
</div>
</div>
<div id="106" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>prd <span class="op">=</span> <span class="fu">predict</span>(dt_sdm, env_covariates; threshold <span class="op">=</span> <span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<div id="108" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>(; size <span class="op">=</span> (<span class="fl">600</span>, <span class="fl">300</span>))</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">1</span>, <span class="fl">1</span>]; aspect <span class="op">=</span> <span class="fu">DataAspect</span>(), title <span class="op">=</span> <span class="st">"Prediction (decision tree)"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>hm <span class="op">=</span> <span class="fu">heatmap!</span>(ax, prd; colormap <span class="op">=</span> <span class="op">:</span>linear_worb_100_25_c53_n256, colorrange <span class="op">=</span> (<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Colorbar</span>(f[<span class="fl">1</span>, <span class="fl">2</span>], hm)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(ax, switzerland; color <span class="op">=</span> <span class="op">:</span>black)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-55-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>TK</strong> compare DT to Naive Bayes</p>
</section>
<section id="making-a-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="making-a-random-forest">Making a random forest</h2>
<div id="110" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>single_dt_sdm <span class="op">=</span> <span class="fu">SDM</span>(PCATransform, DecisionTree, env_covariates, presencelayer, pseudoabsences)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>rf_sdm <span class="op">=</span> <span class="fu">Bagging</span>(single_dt_sdm, <span class="fl">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{SDeMo.PCATransform → SDeMo.DecisionTree → P(x) ≥ 0.5} × 30</code></pre>
</div>
</div>
<div id="112" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bagfeatures!</span>(rf_sdm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{SDeMo.PCATransform → SDeMo.DecisionTree → P(x) ≥ 0.5} × 30</code></pre>
</div>
</div>
<div id="114" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#variables!(rf_sdm, AllVariables)</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="fu">variables!</span>(rf_sdm, ForwardSelection, <span class="fu">kfold</span>(rf_sdm, k<span class="op">=</span><span class="fl">2</span>); bagfeatures <span class="op">=</span> <span class="cn">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 50.623661 seconds (512.97 M allocations: 58.921 GiB, 14.61% gc time)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{SDeMo.PCATransform → SDeMo.DecisionTree → P(x) ≥ 0.303} × 30</code></pre>
</div>
</div>
<div id="116" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">train!</span>(rf_sdm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>{SDeMo.PCATransform → SDeMo.DecisionTree → P(x) ≥ 0.303} × 30</code></pre>
</div>
</div>
<div id="118" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>prd <span class="op">=</span> <span class="fu">predict</span>(rf_sdm, env_covariates; threshold <span class="op">=</span> <span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<div id="120" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>unc <span class="op">=</span> <span class="fu">predict</span>(rf_sdm, env_covariates; consensus <span class="op">=</span> iqr, threshold <span class="op">=</span> <span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<div id="122" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>(; size <span class="op">=</span> (<span class="fl">600</span>, <span class="fl">600</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">1</span>, <span class="fl">1</span>]; aspect <span class="op">=</span> <span class="fu">DataAspect</span>(), title <span class="op">=</span> <span class="st">"Prediction"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>hm <span class="op">=</span> <span class="fu">heatmap!</span>(ax, prd; colormap <span class="op">=</span> <span class="op">:</span>linear_worb_100_25_c53_n256, colorrange <span class="op">=</span> (<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Colorbar</span>(f[<span class="fl">1</span>, <span class="fl">2</span>], hm)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(ax, switzerland; color <span class="op">=</span> <span class="op">:</span>black)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">2</span>, <span class="fl">1</span>]; aspect <span class="op">=</span> <span class="fu">DataAspect</span>(), title <span class="op">=</span> <span class="st">"Uncertainty"</span>)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>hm <span class="op">=</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">heatmap!</span>(ax2, <span class="fu">quantize</span>(unc); colormap <span class="op">=</span> <span class="op">:</span>linear_gow_60_85_c27_n256, colorrange <span class="op">=</span> (<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a><span class="fu">Colorbar</span>(f[<span class="fl">2</span>, <span class="fl">2</span>], hm)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(ax2, switzerland; color <span class="op">=</span> <span class="op">:</span>black)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax2)</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax2)</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-62-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boosting-to-create-a-brt" class="level2">
<h2 class="anchored" data-anchor-id="boosting-to-create-a-brt">Boosting to create a BRT</h2>
<p>TODO</p>
</section>
</section>
<section id="explaining-an-brts-predictions" class="level1">
<h1>Explaining an BRT’s predictions</h1>
<section id="partial-responses" class="level2">
<h2 class="anchored" data-anchor-id="partial-responses">Partial Responses</h2>
<div id="124" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">variables</span>(rf_sdm)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>prt <span class="op">=</span> <span class="fu">partialresponse</span>(rf_sdm, <span class="fu">variables</span>(rf_sdm)[<span class="fl">6</span>])</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterlines</span>(prt<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-63-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Partial response in space</p>
<div id="126" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>partial1 <span class="op">=</span> <span class="fu">partialresponse</span>(rf_sdm, env_covariates, <span class="fl">1</span>; threshold<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Float64 cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
</section>
<section id="shap-values" class="level2">
<h2 class="anchored" data-anchor-id="shap-values">SHAP Values</h2>
<p>Layer-wise</p>
<div id="128" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#shapley1 = explain(rf_sdm, env_covariates, 1; threshold=false)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All at once (this takes a while)</p>
<div id="130" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#@time S = explain(rf_sdm, env_covariates; threshold=false)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="132" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>(; size <span class="op">=</span> (<span class="fl">600</span>, <span class="fl">300</span>))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>mostimp <span class="op">=</span> <span class="fu">mosaic</span>(argmax, <span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">abs</span>.(x), S))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>colmap <span class="op">=</span> [colorant<span class="st">"#E69F00"</span>, colorant<span class="st">"#56B4E9"</span>, colorant<span class="st">"#009E73"</span>, colorant<span class="st">"#D55E00"</span>, colorant<span class="st">"#CC79A7"</span>, colorant<span class="st">"#a65dab"</span>, colorant<span class="st">"#da6161"</span>]</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">1</span>, <span class="fl">1</span>]; aspect <span class="op">=</span> <span class="fu">DataAspect</span>())</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap!</span>(ax, mostimp; colormap <span class="op">=</span> colmap)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines!</span>(ax, switzerland; color <span class="op">=</span> <span class="op">:</span>black)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">Legend</span>(</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>    f[<span class="fl">2</span>, <span class="fl">1</span>],</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>    [<span class="fu">PolyElement</span>(; color <span class="op">=</span> colmap[i]) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(<span class="fu">variables</span>(rf_sdm))],</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"BIO</span><span class="sc">$</span>(b)<span class="st">"</span> for b <span class="kw">in</span> <span class="fu">variables</span>(rf_sdm)];</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    orientation <span class="op">=</span> <span class="op">:</span>horizontal,</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>    nbanks <span class="op">=</span> <span class="fl">1</span>,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    framevisible <span class="op">=</span> <span class="cn">false</span>,</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    vertical <span class="op">=</span> <span class="cn">false</span>,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conformal-prediction" class="level2">
<h2 class="anchored" data-anchor-id="conformal-prediction">Conformal Prediction</h2>
<p>Conformal prediction is another method for interpreting machine learning models. Specifically, it is a form of <em>uncertainty quantification</em>.</p>
<p>Let’s talk about uncertainty. A few sections ago, we generated a map of ucnertainty from our bagged model. This was done by measuring the interquantile range across each individual tree.</p>
<div id="134" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">"conformal_prediction.jl"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>cellsize (generic function with 1 method)</code></pre>
</div>
</div>
<div id="136" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>rlevels <span class="op">=</span> <span class="fu">LinRange</span>(<span class="fl">0.01</span>, <span class="fl">0.2</span>, <span class="fl">100</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>qs <span class="op">=</span> [<span class="fu">_estimate_q</span>(rf_sdm, <span class="fu">holdout</span>(rf_sdm)<span class="op">...</span>; α<span class="op">=</span>u) for u <span class="kw">in</span> rlevels]</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>𝐏 <span class="op">=</span> <span class="fu">predict</span>(rf_sdm; threshold<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>eff <span class="op">=</span> [<span class="fu">mean</span>(<span class="fu">length</span>.(<span class="fu">credibleclasses</span>.(𝐏, q))) for q <span class="kw">in</span> qs]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>100-element Vector{Float64}:
 1.5382011605415862
 1.5382011605415862
 1.3786266924564796
 1.1731141199226305
 1.1731141199226305
 1.175531914893617
 1.1344294003868471
 1.4550290135396517
 1.2166344294003868
 1.1697292069632494
 ⋮
 0.9061895551257253
 0.8950676982591876
 0.8936170212765957
 0.8853965183752418
 0.9177949709864603
 0.9177949709864603
 0.8955512572533849
 0.9216634429400387
 0.8655705996131529</code></pre>
</div>
</div>
<div id="138" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>cs <span class="op">=</span> <span class="fu">cellsize</span>(prd)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>cmodel <span class="op">=</span> <span class="fu">deepcopy</span>(rf_sdm)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># majority rules arg for consensus should give bool</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>distrib <span class="op">=</span> <span class="fu">predict</span>(cmodel, env_covariates; consensus<span class="op">=</span>majority, threshold<span class="op">=</span><span class="cn">true</span>)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(qs)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    Cp, Ca <span class="op">=</span> <span class="fu">credibleclasses</span>(prd, qs[i])</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    undet <span class="op">=</span> .!(Cp <span class="op">.|</span> Ca)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    sure_presence <span class="op">=</span> Cp <span class="op">.&amp;</span> (.!Ca)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    unsure <span class="op">=</span> Ca <span class="op">.&amp;</span> Cp</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    unsure_presence <span class="op">=</span> unsure <span class="op">.&amp;</span> distrib</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    unsure_absence <span class="op">=</span> unsure <span class="op">.&amp;</span> (.!distrib)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-conformal with median range selected</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fu">median</span>([<span class="fu">_estimate_q</span>(cmodel, fold<span class="op">...</span>; α<span class="op">=</span><span class="fl">0.05</span>) for fold <span class="kw">in</span> <span class="fu">kfold</span>(cmodel; k<span class="op">=</span><span class="fl">10</span>)])</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>Cp, Ca <span class="op">=</span> <span class="fu">credibleclasses</span>(prd, q)</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Partition</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>sure_presence <span class="op">=</span> Cp <span class="op">.&amp;</span> (.!Ca)</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>sure_absence <span class="op">=</span> Ca <span class="op">.&amp;</span> (.!Cp)</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>unsure <span class="op">=</span> Ca <span class="op">.&amp;</span> Cp</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>unsure_in <span class="op">=</span> unsure <span class="op">.&amp;</span> distrib</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>unsure_out <span class="op">=</span> unsure <span class="op">.&amp;</span> (.!distrib)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>🗺️  A 240 × 546 layer with 70065 Bool cells
   Projection: +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<div id="140" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fu">Figure</span>(; size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> <span class="fu">Axis</span>(f[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span>]; aspect<span class="op">=</span><span class="fu">DataAspect</span>())</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">poly!</span>(ax, switzerland, color<span class="op">=:</span>grey95)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap!</span>(ax, <span class="fu">nodata</span>(sure_presence, <span class="cn">false</span>), colormap<span class="op">=</span>[<span class="op">:</span>forestgreen])</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap!</span>(ax, <span class="fu">nodata</span>(unsure, <span class="cn">false</span>), colormap<span class="op">=</span>[<span class="op">:</span>grey70])</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hidespines!</span>(ax)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hidedecorations!</span>(ax)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-71-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="counterfactuals" class="level2">
<h2 class="anchored" data-anchor-id="counterfactuals">Counterfactuals</h2>
</section>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="what-if-i-want-to-use-a-different-model" class="level2">
<h2 class="anchored" data-anchor-id="what-if-i-want-to-use-a-different-model">What if I want to use a different model?</h2>
<p>We can extract features and labels as a whole, but we can also use some more fine-grained functions to setup crossvalidation splits without inducing data leakage.</p>


</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/PoisotLab\.github\.io\/CSEE2025_Workshop\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>